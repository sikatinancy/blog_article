{% extends 'base.html' %}

{% block content %}
<div class="max-w-md mx-auto bg-white p-6 rounded-lg shadow-lg">
    <h2 class="text-2xl font-bold text-primary mb-4">Inscription</h2>
    {% if error %}
        <p class="text-red-500">{{ error }}</p>
    {% endif %}
    
    <form id="registerForm">
        {% csrf_token %}
        <div class="mb-4">
            <label class="block text-gray-700">Nom d'utilisateur</label>
            <input type="text" name="username" class="w-full p-2 border rounded" required>
        </div>
        <div class="mb-4">
            <label class="block text-gray-700">Email</label>
            <input type="email" name="email" class="w-full p-2 border rounded" required>
        </div>
        <div class="mb-4">
            <label class="block text-gray-700">Mot de passe</label>
            <input type="password" name="password" class="w-full p-2 border rounded" required>
        </div>
        <button type="submit" class="bg-accent text-white p-2 rounded hover:bg-orange-700 text-secondary">
            S'inscrire
        </button>
    </form>

    <p id="registerMessage" class="mt-4 text-center text-sm"></p>
</div>

<script>
document.getElementById("registerForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const form = e.target;
    const data = {
        username: form.username.value,
        email: form.email.value,
        password: form.password.value,
    };

    const response = await fetch("{% url 'users:register' %}", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": document.querySelector("[name=csrfmiddlewaretoken]").value
        },
        body: JSON.stringify(data),
    });

    const result = await response.json();
    const messageEl = document.getElementById("registerMessage");

    if (response.ok) {
        messageEl.innerText = "✅ Inscription réussie ! Vous pouvez maintenant vous connecter.";
        messageEl.classList.remove("text-red-500");
        messageEl.classList.add("text-green-600");
        form.reset();
    } else {
        messageEl.innerText = "❌ Erreur : " + (result.detail || JSON.stringify(result));
        messageEl.classList.remove("text-green-600");
        messageEl.classList.add("text-red-500");
    }
});
</script>
{% endblock %}
